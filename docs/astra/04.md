---
sidebar_position: 4
---

# Резервное копирование Postgres

## Резервное копирование

```
sudo pg_dump -h localhost -U postgres -f /BACKUP/test1.tar -F tar test1
```
* test1 - база данных;


## Восстановление
```
sudo pg_restore -h localhost -U postgres -d test2 /BACKUP/test1.tar
```

## Скрипт для CRON

* создаем файл pg-backup.sh
```
#!/bin/bash

db_name=test1
db_user=postgres
db_host=localhost
backupfolder=/BACKUP
keep_day=7

sqlfile=$backupfolder/$db_name-$(date +%d-%m-%Y_%H-%M-%S).sql
gzfile=$backupfolder/$db_name-$(date +%d-%m-%Y_%H-%M-%S).gz
mkdir -p $backupfolder

if pg_dump -U $db_user -h $db_host $db_name -f $sqlfile ; then
   echo 'Sql dump created'
else
   echo '!!! pg_dump return non-zero code'
   exit
fi

if gzip $sqlfile; then
   echo 'The backup was successfully compressed'
else
   echo '!!! Error compressing backup'
   exit
fi
rm $sqlfile