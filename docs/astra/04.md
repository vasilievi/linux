---
sidebar_position: 4
---

# Резервное копирование Postgres

## Резервное копирование

* создаем файл pg-backup.sh, в скрипте жестко прописана папка для резервного копирования BACKUP, сервер localhost и пользователь БД postgres, база данных задается параметром
```
#!/bin/bash

db=$1
backupfolder=/BACKUP
backupfile=$backupfolder/$db-$(date +%Y-%m-%d_%H-%M-%S).tar

mkdir -p $backupfolder

if pg_dump -h localhost -U postgres -f $backupfile -F tar $db ; then
   echo 'ok'
   gzip $backupfile
else
   echo 'error!'
   exit
fi

find $backupfolder -mtime 10 -delete
```
* проверяем работу скрипта
```
pg-backup.sh test1
```

* устанавливаем в cron копирование базы **test1** каждый день в 00:00 и базы **test2** в 01:00
```
sudo crontab -e
0 0 * * * /home/profcase/pg-backup.sh test1
1 0 * * * /home/profcase/pg-backup.sh test2
```

## Восстановление
* восстановление в базу test2 (ВНИМАНИЕ! База test2 очистится перед загрузкой тк стоит параметр -c)
```
pg_restore -c -h localhost -U postgres -d test2 /BACKUP/test1-2025-12-02_07-39-29.tar
```